const express = require('express');\nconst serverless = require('serverless-http');\nconst cors = require('cors');\nconst helmet = require('helmet');\nconst mongoSanitize = require('express-mongo-sanitize');\nconst rateLimit = require('express-rate-limit');\nconst connectDB = require('../../backend/src/config/db');\nconst errorHandler = require('../../backend/src/middleware/errorHandler');\n\n// Import routes\nconst authRoutes = require('../../backend/src/routes/authRoutes');\nconst recordRoutes = require('../../backend/src/routes/recordRoutes');\nconst doctorRoutes = require('../../backend/src/routes/doctorRoutes');\nconst auditRoutes = require('../../backend/src/routes/auditRoutes');\nconst userRoutes = require('../../backend/src/routes/userRoutes');\nconst requestRoutes = require('../../backend/src/routes/requestRoutes');\nconst simpleAccessRoutes = require('../../backend/src/routes/simpleAccessRoutes');\nconst codeAccessRoutes = require('../../backend/src/routes/codeAccessRoutes');\n\n// Connect to database\nconnectDB();\n\nconst app = express();\n\n// Middleware\napp.use(helmet({ crossOriginEmbedderPolicy: false }));\napp.use(cors({ \n  origin: true,\n  credentials: true \n}));\napp.use(express.json());\napp.use(express.urlencoded({ extended: true }));\napp.use(mongoSanitize());\n\n// Rate limiting\nconst authLimiter = rateLimit({\n  windowMs: 15 * 60 * 1000,\n  max: 20,\n  message: { success: false, error: 'Too many requests from this IP, please try again after 15 minutes' },\n});\n\napp.use('/auth', authLimiter);\n\n// Routes\napp.use('/auth', authRoutes);\napp.use('/records', recordRoutes);\napp.use('/doctor', doctorRoutes);\napp.use('/audit', auditRoutes);\napp.use('/user', userRoutes);\napp.use('/requests', requestRoutes);\napp.use('/access', simpleAccessRoutes);\napp.use('/code', codeAccessRoutes);\n\napp.get('/health', (req, res) => res.json({ success: true, message: 'MedVault API running on Netlify' }));\n\napp.use(errorHandler);\n\nmodule.exports.handler = serverless(app);